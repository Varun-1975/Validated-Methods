async function loadTableFromSheet(e){const t=await fetch(e),n=parseTSV(await t.text()),l=document.getElementById("data-container");if(!l)return void console.error("Data container element not found");l.innerHTML="";const a=document.createElement("table"),o=document.createElement("thead"),c=document.createElement("tbody");a.appendChild(o),a.appendChild(c);let r=Array(n[0].length).fill(null),i=document.createElement("tr");n[0].forEach((e=>{let t=document.createElement("th");t.textContent=e,i.appendChild(t)})),o.appendChild(i),n.slice(1).forEach((e=>{let t=document.createElement("tr");e.forEach(((e,n)=>{if(""===e.trim()&&null!=r[n])r[n].rowSpan+=1;else{let l=document.createElement("td");if(3===n&&isValidUrl(e)){let t=document.createElement("a");t.href="#",t.textContent="Preview",t.addEventListener("click",(function(t){t.preventDefault(),openPreviewWindow(e)})),l.appendChild(t)}else l.textContent=e;1!==n&&2!==n||l.classList.add(`column-${n+1}`),t.appendChild(l),r[n]=l}})),c.appendChild(t)})),l.appendChild(a)}function parseTSV(e){return e.split("\n").map((e=>e.split("\t")))}async function fetchTSVData(e){const t=await fetch(e);return(await t.text()).split("\n").map((e=>e.split("\t")))}function isImageLink(e){return e.startsWith("https://go.drugbank.com/structures/")||e.startsWith("https://www.clearsynth.com/structure/")||e.startsWith("https://cdn.discordapp.com/attachments/")}function createTable(e){const t=document.createElement("table");t.className="data-table";const n=document.createElement("tr");let l=null;return e[0].forEach(((e,t)=>{const a=document.createElement("th");a.textContent=e,a.style.textAlign="center",a.style.fontWeight="bold",t>0&&""===e.trim()&&l?l.colSpan+=1:(n.appendChild(a),l=a)})),t.appendChild(n),e.slice(1).forEach(((e,n)=>{const l=document.createElement("tr");let a=null;e.forEach(((e,t)=>{const o=document.createElement("td");if(0===n&&isImageLink(e)){const t=document.createElement("img");t.src=e,t.alt="Image",t.style.maxWidth="100%",t.style.height="auto",o.appendChild(t)}else o.textContent=e,0===t&&(o.style.fontWeight="bold");""===e.trim()?a&&(a.colSpan+=1,3===a.colSpan&&applyStylesToCell(a)):(l.appendChild(o),a=o)})),t.appendChild(l)})),t}function applyStylesToCell(e){e.style.textAlign="center",e.style.fontWeight="bold"}function initializeTable(){const e=document.getElementById("data-container");fetchTSVData(e.getAttribute("data-sheet-url")).then((t=>{e.innerHTML="";const n=createTable(t);e.appendChild(n)}))}function openPreviewWindow(e){const t=document.getElementById("preview-container");t.innerHTML="",fetchTSVData(e).then((e=>{const n=createTable(e);t.appendChild(n)}));const n=document.querySelector(".preview-area");n.style.display="block",n.style.width="50%",n.style.flex="1";document.querySelector(".table-area").style.flex="1",t.innerHTML='\n        <div class="preview-content">\n            <button id="close-preview" class="close-preview" onclick="closePreviewWindow()">Close</button>\n        </div>'}function closePreviewWindow(){const e=document.querySelector(".preview-area");e.style.display="none",e.style.width="0",e.style.flex="0";document.querySelector(".table-area").style.flex="1"}function isValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("data-container");if(!e)return void console.error("Data container element not found");const t=e.getAttribute("data-sheet-url");t?loadTableFromSheet(t):console.error("No data-sheet-url found")}));
